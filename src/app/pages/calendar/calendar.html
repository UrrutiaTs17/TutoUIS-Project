<div class="container py-4">

  <!-- Buscador -->
  <div class="card search-card mb-4">
    <div class="card-body position-relative">
      <h2 class="h4 mb-3">
        <i class="bi bi-search me-2" aria-hidden="true"></i>
        Buscar Materias
      </h2>

      <div class="position-relative">
        <input
          class="form-control form-control-lg ps-5 pe-5"
          placeholder="Escribe el nombre de la materia…"
          [formControl]="searchControl"
          (keydown.enter)="selectFirst()"
          aria-label="Buscar materias"
          autocomplete="off"
        />
        <!-- icono lupa -->
        <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3" aria-hidden="true"></i>

        <!-- botón limpiar -->
        <button *ngIf="(suggestions$ | async)?.length || searchControl.value"
                type="button"
                class="btn btn-sm btn-link position-absolute top-50 end-0 translate-middle-y me-2"
                (click)="clear()">
          Limpiar
        </button>

        <!-- Sugerencias -->
        <ul *ngIf="showDropdown"
            class="list-group position-absolute w-100 mt-2 shadow-sm rounded-3"
            role="listbox" style="z-index:10;">
          <li *ngFor="let c of (suggestions$ | async); let i = index; trackBy: trackMateria"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            role="option" (click)="select(c)"
            [class.active]="i === activeIndex">
          <span>
              {{ c.nombre }}
            <small class="text-muted">• {{ c.docente }}</small>
            </span>
            <span class="badge bg-success-subtle text-success">{{ c.cupos }}</span>
          </li>

          <li *ngIf="(suggestions$ | async)?.length === 0"
              class="list-group-item text-muted">
            No hay resultados para “{{ searchControl.value }}”.
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Calendario -->
  <div class="card calendar-card">
    <div class="card-header bg-light d-flex align-items-center gap-2">
      <i class="bi bi-calendar3" aria-hidden="true"></i>
      <h3 class="mb-0">Horario Disponible  </h3>
    </div>

    <div class="card-body p-0">
      <div class="table-responsive calendar-scroll">
        <table class="table calendar-table align-middle" role="grid" aria-label="Horario semanal">
          <caption class="visually-hidden">Calendario semanal de tutorías</caption>

          <thead>
            <tr>
              <th class="time-col" scope="col">Hora</th>
              <th class="day-col" scope="col" *ngFor="let d of dias; trackBy: trackDia">
                {{ d }}
              </th>
            </tr>
          </thead>

          <tbody>
  <tr *ngFor="let h of horas; trackBy: trackHora">
    <th class="time-col" scope="row">
      <span class="time-badge">
        <i class="bi bi-clock me-1" aria-hidden="true"></i>
        {{ h }}
      </span>
    </th>

    <td *ngFor="let d of dias; trackBy: trackDia"
        class="schedule-cell"
        tabindex="0" role="button"
        [attr.data-hora]="h" [attr.data-dia]="d"
        (click)="selectCell(h,d)"
        (keydown.enter)="selectCell(h,d)"
        [class.is-selected]="isSelected(h,d)">

      <!-- tarjeta si hay materia colocada en esa celda -->
      <ng-container *ngIf="getMateria(h,d) as m; else emptyCell">
        <article class="curso-card" [ngClass]="m.clase" [title]="m.tooltip || ''">
          <h4 class="curso-title">{{ m.nombre }}</h4>
          <p class="curso-meta">{{ m.detalle }}</p>
          <div class="curso-badges">
            <span class="badge-cap">Cupos: {{ m.cupos }}</span>
          </div>
        </article>
      </ng-container>

      <!-- celda vacía accesible -->
      <ng-template #emptyCell>
        <span class="visually-hidden">Sin asignación</span>
      </ng-template>
    </td>
  </tr>
</tbody>>

