<div class="modal fade" id="reservaDetailModal" tabindex="-1" aria-labelledby="reservaDetailLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header" [ngClass]="isEditMode ? 'bg-primary' : 'bg-success'">
        <h5 class="modal-title text-white" id="reservaDetailLabel">
          <i class="bi" [ngClass]="isEditMode ? 'bi-pencil-square' : 'bi-info-circle'" class="me-2"></i>
          {{ isEditMode ? 'Editar Reserva' : 'Detalles de la Reserva' }} #{{ reserva?.idReserva }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeModal()" aria-label="Close"></button>
      </div>

      <!-- Body -->
      <div class="modal-body" *ngIf="reserva">
        <!-- Loading -->
        <div *ngIf="isLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="mt-3">Procesando...</p>
        </div>

        <!-- Error Alert -->
        <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ error }}
          <button type="button" class="btn-close" (click)="error = null" aria-label="Close"></button>
        </div>

        <!-- Content -->
        <div *ngIf="!isLoading">
          <!-- Información del Estudiante -->
          <div class="info-section">
            <h6 class="section-title">
              <i class="bi bi-person-fill me-2"></i>
              Información del Estudiante
            </h6>
            <div class="row">
              <div class="col-md-8">
                <div class="info-item">
                  <label>Nombre Completo</label>
                  <p>{{ reserva.nombreEstudiante || 'No especificado' }}</p>
                </div>
              </div>
              <div class="col-md-4">
                <div class="info-item">
                  <label>ID</label>
                  <p>{{ reserva.idEstudiante }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Información de la Tutoría -->
          <div class="info-section">
            <h6 class="section-title">
              <i class="bi bi-book-fill me-2"></i>
              Información de la Tutoría
            </h6>
            <div class="row">
              <div class="col-md-6">
                <div class="info-item">
                  <label>Asignatura</label>
                  <p>{{ reserva.nombreAsignatura || 'No especificada' }}</p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <label>Tutor</label>
                  <p>{{ reserva.nombreTutor || 'No especificado' }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Horarios -->
          <div class="info-section">
            <h6 class="section-title">
              <i class="bi bi-clock-fill me-2"></i>
              Horarios
            </h6>
            
            <!-- Modo Vista -->
            <div *ngIf="!isEditMode">
              <div class="row">
                <div class="col-md-6">
                  <div class="info-item">
                    <label>Horario de Reserva</label>
                    <p class="time-highlight">
                      <i class="bi bi-alarm me-1"></i>
                      {{ reserva.horaInicio }} - {{ reserva.horaFin }}
                    </p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item">
                    <label>Horario de Disponibilidad</label>
                    <p>
                      <i class="bi bi-calendar-range me-1"></i>
                      {{ reserva.disponibilidadHoraInicio || 'N/A' }} - {{ reserva.disponibilidadHoraFin || 'N/A' }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modo Edición -->
            <div *ngIf="isEditMode">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="horaInicio" class="form-label">Hora de Inicio <span class="text-danger">*</span></label>
                    <input
                      type="time"
                      class="form-control"
                      id="horaInicio"
                      [(ngModel)]="editData.horaInicio"
                      required
                    />
                    <small class="text-muted">Formato 24 horas (HH:mm)</small>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="horaFin" class="form-label">Hora de Fin <span class="text-danger">*</span></label>
                    <input
                      type="time"
                      class="form-control"
                      id="horaFin"
                      [(ngModel)]="editData.horaFin"
                      required
                    />
                    <small class="text-muted">Formato 24 horas (HH:mm)</small>
                  </div>
                </div>
              </div>
              <div class="alert alert-info mb-0">
                <i class="bi bi-info-circle me-2"></i>
                <small>Disponibilidad original: {{ reserva.disponibilidadHoraInicio }} - {{ reserva.disponibilidadHoraFin }}</small>
              </div>
            </div>
          </div>

          <!-- Estado y Observaciones -->
          <div class="info-section">
            <h6 class="section-title">
              <i class="bi bi-card-checklist me-2"></i>
              Detalles Adicionales
            </h6>
            <div class="row">
              <div class="col-md-4">
                <div class="info-item">
                  <label>Estado</label>
                  <p>
                    <span class="badge" [ngClass]="getEstadoBadgeClass()">
                      {{ reserva.nombreEstado || 'Sin estado' }}
                    </span>
                  </p>
                </div>
              </div>
              <div class="col-md-8">
                <div class="info-item" *ngIf="!isEditMode">
                  <label>Observaciones</label>
                  <p>{{ reserva.observaciones || 'Sin observaciones' }}</p>
                </div>
                <div class="mb-3" *ngIf="isEditMode">
                  <label for="observaciones" class="form-label">Observaciones</label>
                  <textarea
                    class="form-control"
                    id="observaciones"
                    rows="3"
                    [(ngModel)]="editData.observaciones"
                    placeholder="Ingresa observaciones adicionales..."
                  ></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Fechas -->
          <div class="info-section">
            <h6 class="section-title">
              <i class="bi bi-calendar-event me-2"></i>
              Fechas
            </h6>
            <div class="row">
              <div class="col-md-6">
                <div class="info-item">
                  <label>Fecha de Creación</label>
                  <p>{{ formatDate(reserva.fechaCreacion) }}</p>
                </div>
              </div>
              <div class="col-md-6" *ngIf="reserva.fechaCancelacion">
                <div class="info-item">
                  <label>Fecha de Cancelación</label>
                  <p class="text-danger">{{ formatDate(reserva.fechaCancelacion) }}</p>
                </div>
              </div>
            </div>
            <div *ngIf="reserva.razonCancelacion" class="alert alert-warning mb-0">
              <strong>Razón de cancelación:</strong> {{ reserva.razonCancelacion }}
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          <i class="bi bi-x-circle me-1"></i>
          Cerrar
        </button>
        
        <div *ngIf="!isEditMode && reserva?.nombreEstado !== 'Cancelada'" class="d-flex gap-2">
          <button type="button" class="btn btn-primary" (click)="switchToEditMode()">
            <i class="bi bi-pencil-square me-1"></i>
            Editar
          </button>
          <button type="button" class="btn btn-danger" (click)="cancelarReserva()">
            <i class="bi bi-x-circle me-1"></i>
            Cancelar Reserva
          </button>
        </div>

        <div *ngIf="isEditMode">
          <button type="button" class="btn btn-success" (click)="onSubmit()" [disabled]="isLoading">
            <i class="bi bi-check-circle me-1"></i>
            Guardar Cambios
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
